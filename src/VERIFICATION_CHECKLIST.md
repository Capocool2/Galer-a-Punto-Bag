# Lista de Verificaci√≥n - Despliegue Exitoso

## ‚úÖ Checklist Antes del Despliegue

### 1. Verificar Proyecto Supabase

- [ ] El proyecto est√° activo (no pausado)
- [ ] Tienes permisos de Owner o Admin
- [ ] El proyecto tiene recursos disponibles (no ha excedido l√≠mites)

**C√≥mo verificar:**
1. Ve a https://supabase.com/dashboard
2. Selecciona tu proyecto
3. Ve a Settings ‚Üí General
4. Verifica el estado y tu rol

### 2. Verificar Base de Datos

- [ ] La tabla `kv_store_985839ee` existe

**Script SQL para crear la tabla:**
```sql
CREATE TABLE IF NOT EXISTS kv_store_985839ee (
  key TEXT NOT NULL PRIMARY KEY,
  value JSONB NOT NULL
);
```

**Ejecutar en:** Database ‚Üí SQL Editor

### 3. Verificar Storage

- [ ] El bucket `make-985839ee-products` existe O se puede crear autom√°ticamente

**Configuraci√≥n del bucket (si lo creas manualmente):**
- Nombre: `make-985839ee-products`
- P√∫blico: **NO**
- Tama√±o m√°ximo: 5MB

**Ubicaci√≥n:** Storage ‚Üí Buckets

### 4. Verificar Estructura de Archivos

- [ ] `/supabase/functions/server/index.tsx` existe
- [ ] `/supabase/functions/server/kv_store.tsx` existe
- [ ] `/supabase/functions/server/deno.json` existe

**Verificar que los archivos tienen el contenido correcto**

### 5. Verificar C√≥digo

#### index.tsx debe tener:
- [x] Importaciones correctas (Hono 4, Supabase JS 2)
- [x] CORS configurado
- [x] Todas las rutas (`/make-server-985839ee/*`)
- [x] Manejo de errores
- [x] Autenticaci√≥n en endpoints protegidos

#### kv_store.tsx debe tener:
- [x] Importaci√≥n de Supabase correcta
- [x] Funciones: set, get, del, mset, mget, mdel, getByPrefix
- [x] Validaci√≥n de variables de entorno

## üîç Diagn√≥stico del Error 403

### Paso 1: Verificar Conexi√≥n
```
Error actual: XHR for "/api/integrations/supabase/.../edge_functions/make-server/deploy" failed with status 403
```

**Posibles causas:**
1. Permisos insuficientes en Supabase
2. Conexi√≥n de Figma Make expirada
3. Proyecto pausado o inactivo
4. L√≠mites del plan alcanzados
5. Nombre de funci√≥n incorrecto

### Paso 2: Verificar Nombre de Funci√≥n

El error menciona `make-server` pero podr√≠a necesitar ser `make-server-985839ee`.

**Acci√≥n:** Verifica en Figma Make que el nombre de la funci√≥n coincida con las rutas en el c√≥digo.

### Paso 3: Refrescar Conexi√≥n

1. En Figma Make ‚Üí Settings ‚Üí Integrations
2. Desconecta Supabase
3. Vuelve a conectar
4. Autoriza todos los permisos
5. Intenta desplegar de nuevo

## üöÄ Proceso de Despliegue Correcto

### Desde Figma Make (Recomendado)

1. **Preparaci√≥n:**
   - Aseg√∫rate de que todos los checkpoints anteriores est√°n ‚úì
   - Guarda todos los cambios en los archivos
   - Verifica la conexi√≥n a Supabase

2. **Despliegue:**
   - Click en "Deploy" o el bot√≥n de despliegue
   - Espera a que se complete (puede tardar 1-2 minutos)
   - Verifica los logs

3. **Verificaci√≥n Post-Despliegue:**
   - Ve a Supabase Dashboard ‚Üí Edge Functions
   - Deber√≠as ver la funci√≥n `make-server-985839ee`
   - Verifica que est√© activa (status: active)

### Desde Supabase CLI (Alternativa)

Si Figma Make contin√∫a dando error 403:

```bash
# 1. Instalar CLI
npm install -g supabase

# 2. Login
supabase login

# 3. Vincular proyecto
supabase link --project-ref TU_PROJECT_REF

# 4. Desplegar
supabase functions deploy make-server-985839ee --no-verify-jwt
```

**Nota:** Encuentra tu PROJECT_REF en Settings ‚Üí General (es un c√≥digo como: `myuxcigxokngwljwucwh`)

## üß™ Pruebas Post-Despliegue

### Test 1: Health Check

```bash
curl https://TU_PROJECT_REF.supabase.co/functions/v1/make-server-985839ee/health
```

**Respuesta esperada:**
```json
{
  "status": "ok",
  "timestamp": "2025-10-28T..."
}
```

### Test 2: Get Products

```bash
curl https://TU_PROJECT_REF.supabase.co/functions/v1/make-server-985839ee/products
```

**Respuesta esperada:**
```json
{
  "products": []
}
```

### Test 3: Desde la Aplicaci√≥n

1. Abre la aplicaci√≥n
2. Verifica que las secciones de productos cargan
3. Intenta login como admin
4. Sube un producto de prueba
5. Verifica que aparece en la tienda

## ‚ö†Ô∏è Problemas Comunes y Soluciones

### Error: "Missing Supabase environment variables"

**Soluci√≥n:**
Las variables se configuran autom√°ticamente. Si no:
1. Ve a Edge Functions ‚Üí Settings en Dashboard
2. No deber√≠as necesitar configurar nada manualmente
3. Si persiste, contacta soporte de Supabase

### Error: "Failed to upload image"

**Soluci√≥n:**
1. Verifica que el bucket existe
2. Verifica permisos del bucket (debe ser privado)
3. Verifica que el archivo es menor a 5MB

### Error: "Unauthorized"

**Soluci√≥n:**
1. Verifica que est√°s logueado
2. El token de autenticaci√≥n debe estar en el header
3. Intenta hacer logout y login de nuevo

### Error: "Product not found"

**Soluci√≥n:**
1. Verifica que la tabla KV store existe
2. Verifica que tienes productos creados
3. Revisa los logs de la edge function

## üìä Verificaci√≥n Final

Despu√©s de un despliegue exitoso, deber√≠as ver:

**En Supabase Dashboard:**
- ‚úÖ Edge Function `make-server-985839ee` activa
- ‚úÖ Bucket `make-985839ee-products` creado
- ‚úÖ Tabla `kv_store_985839ee` con datos
- ‚úÖ Logs sin errores cr√≠ticos

**En la Aplicaci√≥n:**
- ‚úÖ Secciones de productos cargan correctamente
- ‚úÖ Login de admin funciona
- ‚úÖ Panel de administraci√≥n accesible
- ‚úÖ Subida de productos funciona
- ‚úÖ Edici√≥n y eliminaci√≥n funcionan
- ‚úÖ Im√°genes se muestran correctamente
- ‚úÖ Bot√≥n de WhatsApp funciona

## üìû Soporte Adicional

Si despu√©s de seguir todos estos pasos contin√∫as con error 403:

1. **Documenta el error:**
   - Screenshot del error completo
   - Logs de Supabase (si est√°n disponibles)
   - Pasos que seguiste

2. **Contacta soporte:**
   - Supabase Support: https://supabase.com/support
   - Comunidad Discord de Supabase
   - GitHub Discussions de Supabase

3. **Informaci√≥n a incluir:**
   - Project ID (no el Service Role Key!)
   - Descripci√≥n del error 403
   - Que has verificado todos los pasos de este checklist
   - Si el despliegue manual con CLI funcion√≥

## üéØ Resumen Ejecutivo

**Lo m√°s importante:**

1. ‚úÖ Tabla `kv_store_985839ee` debe existir
2. ‚úÖ Debes tener permisos de admin en Supabase
3. ‚úÖ El proyecto debe estar activo
4. ‚úÖ La conexi√≥n de Figma Make debe estar activa
5. ‚úÖ Los archivos deben estar en `/supabase/functions/server/`

**Si todo lo anterior est√° correcto y a√∫n tienes error 403:**
‚Üí El problema es de permisos en Supabase, no del c√≥digo
‚Üí Intenta el despliegue manual con CLI
‚Üí Contacta soporte de Supabase

---

**Fecha:** Octubre 2025  
**Versi√≥n:** 1.0  
**Compatibilidad:** Hono 4, Supabase JS 2, Deno
